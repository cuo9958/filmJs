<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache">
    <!--<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">-->
    <meta name="viewport" content="width=640,user-scalable=no">
    <title>测试</title>
    <style>
        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
        }

        #game_box {
            float: left;
            background: #ccc;
        }
    </style>
</head>
<body>
    <div id="game_border">
        <canvas id="game_box"></canvas>
    </div>
    <script>


        var game = {
            winWidth: 500,          //屏幕宽度
            winHeight: 500,         //屏幕高度
            game_border: null,       //游戏界面的外框
            ctx: null,          //渲染对象
            stage: null,             //舞台
            img: null,


            //初始化宽高
            init: function () {
                // 获取窗口宽度
                if (window.innerWidth) this.winWidth = window.innerWidth;
                else if ((document.body) && (document.body.clientWidth)) this.winWidth = document.body.clientWidth;
                // 获取窗口高度
                if (window.innerHeight) this.winHeight = window.innerHeight;
                else if ((document.body) && (document.body.clientHeight)) this.winHeight = document.body.clientHeight;

                this.game_border = document.getElementById("game_border");
                var canvas = document.getElementById("game_box");
                canvas.width = this.winWidth;
                canvas.height = this.winHeight;

                this.ctx = canvas.getContext("2d");


                var that = this;
                function animate() {
                    that.render();
                    requestAnimationFrame(animate);
                }
                requestAnimationFrame(animate);
            },
            //加载资源
            loadImage: function () {

            },
            //刷新内容
            render: function () {
                if (this.ctx && this.img) {
                    this.ctx.drawImage(this.img, 0, 0, this.winWidth, this.winHeight);
                }
            },
        }
        //场景,场景的宽高
        var Stage = function (w, h) {

            var imgs = [], currFrame = 0;

            this.width = w || 0;
            this.height = h || 0;

            this.load = function (list) {
                for (var i = 0; i < list.length; i++) {
                    var img = new Image();
                    img.index = i;
                    img.onload = function () {
                        console.log("loading,image:" + this.src);
                        imgs[this.index] = this;
                    }
                    img.src = list[i];
                }
            }

            this.run = function () {
                console.log("播放");
                var timer=setInterval(function () {
                    game.ctx.drawImage(imgs[currFrame], 0, 0);
                    currFrame++;
                    //if (currFrame >= imgs.length) clearInterval(timer);
                    if (currFrame >= imgs.length) currFrame=0;
                }, 100);
            }
        }


        var resources = [];
        for (var i = 0; i < 35; i++) {
            if (i < 10) {
                resources.push("page0_00" + i + ".jpg");
            } else {
                resources.push("page0_0" + i + ".jpg");
            }
        }
        window.onload = function () {
            game.init();
            var stage1 = new Stage();
            stage1.load(resources);
            setTimeout(stage1.run, 1000);
        }
    </script>
    <script>
        //TODO:
        //1.说明资源列表
        //2.隔段加载动画素材 game。load
        //3.运行 game。run
        //4.特殊：转场  game。next
    </script>
</body>
</html>