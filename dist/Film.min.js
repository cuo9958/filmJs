var StageOption={width:640,height:1136,speed:.1,turnIn:"",turnOut:"",onStart:function(){},onEnd:function(){}},FilmJS=function(){function n(n){n===void 0&&(n="game_box");this.winWidth=640;this.winHeight=1136;this.renderer=null;this.container=null;this.stageList=[];this.currStage=0;this.onEnd=function(){};window.innerWidth?this.winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(this.winWidth=document.body.clientWidth);window.innerHeight?this.winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(this.winHeight=document.body.clientHeight);this.renderer=PIXI.autoDetectRenderer(this.winWidth,this.winHeight,{transparent:!0,view:document.getElementById(n)});this.container=new PIXI.Container}return n.prototype.add=function(n){this.stageList.push(n)},n.prototype.pool=function(){var t,r,n,i;console.log(this.currStage);t=this;r=this.stageList[this.currStage-1];r.end();n=this.stageList[this.currStage];n?(n.onComplete=function(){t.currStage++;t.pool()},n.play()):(console.log("pool"),this.onEnd());i=this.stageList[this.currStage+1];i&&i.ready(this.container)},n.prototype.start=function(){function i(){requestAnimationFrame(i);n.renderer.render(n.container);TWEEN.update()}var n,t;console.log(this.stageList);n=this;i();t=this.stageList[this.currStage];t.onComplete=function(){n.currStage++;n.pool()};t.ready(this.container)},n.prototype.action=function(){var t=this,i=this.stageList[this.currStage],n;i.onComplete=function(){t.currStage++;t.pool()};i.play();n=this.stageList[this.currStage+1];n&&n.ready(this.container)},n.extend=function(n,t){var r={};for(var i in n)r[i]=n[i];for(i in t)r.hasOwnProperty(i)||(r[i]=t[i]);return r},n.loadImage=function(n,t,i){PIXI.loader.add(n).on("progress",t).load(i&&i())},n}(),FilmStage=function(){function n(n){this.options={};this.onComplete=function(){};this.options=FilmJS.extend(n,StageOption)}return n.prototype._setOffset=function(){switch(this.options.turnIn){case"right":this.clip.x=this.options.width;this.clip.y=0;break;case"left":this.clip.x=-this.options.width;this.clip.y=0;break;default:this.clip.x=0;this.clip.y=0}},n.prototype.ready=function(n){var i,t,r;for(console.log(this.options.resource),FilmJS.loadImage(this.options.resource,function(){},function(){}),i=[],t=0;t<this.options.resource.length;t++)r=PIXI.Texture.fromImage(this.options.resource[t]),i.push(r);this.clip=new PIXI.extras.AnimatedSprite(i);this._setOffset();this.clip.loop=!1;this.clip.animationSpeed=this.options.speed;this.clip.onComplete=this.onComplete;n.addChild(this.clip);this.clip.gotoAndStop(0)},n.prototype.play=function(){var n,t,i;console.log("播放："+this.options.name);n=this;this.clip.onComplete=this.onComplete;this.clip.x!=0||this.clip.y!=0?(t={x:this.clip.x,y:this.clip.y},i=new TWEEN.Tween(t).to({x:0,y:0},1e3).onUpdate(function(){n.clip.x=this.x;n.clip.y=this.y}).onComplete(function(){n.clip.play();n.options.onStart()}).start()):(this.clip.play(),n.options.onStart())},n.prototype.end=function(){var i;console.log("播放结束:"+this.options.name);var t=this,r={x:this.clip.x,y:this.clip.y},n={};switch(this.options.turnOut){case"left":n={x:-this.options.width,y:0};break;case"right":n={x:this.options.width,y:0};break;default:n={x:0,y:0}}i=new TWEEN.Tween(r).to(n,1e3).onUpdate(function(){t.clip.x=this.x}).onComplete(function(){t.options.onEnd()}).start();console.log(i);setTimeout(function(){t.clip.destroy()},2e3)},n}();